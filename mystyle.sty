\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{mystyle}[2025/10/25 My Custom Style]

% Font packages
\RequirePackage{xeCJK}
\setCJKmainfont[AutoFakeBold={3.17}]{芫荽}
\newCJKfontfamily{\sans}[AutoFakeBold={2.17}]{jf open 粉圓 2.1}
\newcommand{\mytitle}[1]{\Large{\sans{#1}}}

% Math and theorem packages
\RequirePackage{amssymb}
\RequirePackage{amsmath}
\RequirePackage{amsthm}
\RequirePackage{braket}
\RequirePackage{tensor}
\RequirePackage{spalign}
\RequirePackage{unicode-math}

% Geometry and spacing
\RequirePackage{enumitem}
\RequirePackage{geometry}
\geometry{
    tmargin=3cm, 
    bmargin=3cm, 
    lmargin=3cm, 
    rmargin=3cm,
    headheight=1.5cm,
    footskip=1.5cm,
    headsep=0.8cm
}
\RequirePackage{setspace}
\setlength{\parskip}{1.3ex plus 0.2ex minus 0.2ex}
\setlength{\baselineskip}{20pt}

% Ornaments and symbols
\RequirePackage{fourier-orns}
\RequirePackage[object=vectorian]{pgfornament}
\RequirePackage{starfont}
\RequirePackage{tikz}
\usetikzlibrary{positioning}

% Custom section commands
\renewcommand*\contentsname{目錄}
\newcommand{\mysubsection}[1]{
    \subsection*{\leafNW #1}
    \addcontentsline{toc}{section}{#1}
}
\newcommand{\mysubsubsection}[1]{
    \subsubsection*{\aldine #1}
    \addcontentsline{toc}{subsection}{#1}
}

% Theorem environments with mdframed
\RequirePackage[table]{xcolor}
\RequirePackage[framemethod=tikz]{mdframed}

% Global mdframed settings
\mdfsetup{%
    topline=false,
    rightline=false,
    bottomline=false,
    linewidth=4pt,
    innerleftmargin=15pt,
    innerrightmargin=15pt,
    innertopmargin=15pt,
    innerbottommargin=10pt,
    skipabove=0.5\baselineskip,
    skipbelow=0.5\baselineskip,
    nobreak=true,
}

% Define theorem styles
\newtheoremstyle{definitionstyle}%
    {0pt}{0pt}% space above and below
    {\setstretch{1.2}}% body font with line spacing
    {}% indent amount
    {\bfseries\color{cyan!90!black}}% theorem head font
    {.}% punctuation after theorem head
    {\newline}% space after theorem head (newline for break)
    {}% theorem head spec

\newtheoremstyle{theoremstyle}%
    {0pt}{0pt}%
    {\setstretch{1.2}}%
    {}%
    {\bfseries\color{violet!90!black}}%
    {.}%
    {\newline}%
    {}%

\newtheoremstyle{corollarystyle}%
    {0pt}{0pt}%
    {\setstretch{1.2}}%
    {}%
    {\bfseries\color{magenta!90!black}}%
    {.}%
    {\newline}%
    {}%

\newtheoremstyle{remarkstyle}%
    {0pt}{0pt}%
    {\setstretch{1.2}}%
    {}%
    {\bfseries}%
    {.}%
    {\newline}%
    {}%

% Define base theorems
\theoremstyle{definitionstyle}
\newtheorem{definitioninner}{Definition}[section]

\theoremstyle{theoremstyle}
\newtheorem{theoreminner}{Theorem}[section]

\theoremstyle{corollarystyle}
\newtheorem{corollaryinner}{Corollary}[theoreminner]

\theoremstyle{remarkstyle}
\newtheorem*{remarkinner}{\Sagittarius\ Remark}

% Create mdframed environments
\newenvironment{definition}[1][]{%
    \begin{mdframed}[linecolor=cyan!90!black,backgroundcolor=cyan!10!white]
    \begin{definitioninner}[#1]
}{%
    \end{definitioninner}
    \end{mdframed}
}

\newenvironment{theorem}[1][]{%
    \begin{mdframed}[linecolor=violet!90!black,backgroundcolor=violet!10!white]
    \begin{theoreminner}[#1]
}{%
    \end{theoreminner}
    \end{mdframed}
}

\newenvironment{corollary}[1][]{%
    \begin{mdframed}[linecolor=magenta!90!black,backgroundcolor=magenta!10!white]
    \begin{corollaryinner}[#1]
}{%
    \end{corollaryinner}
    \end{mdframed}
}

\newenvironment{remark}{%
    \begin{mdframed}[linecolor=black,backgroundcolor=white]
    \begin{remarkinner}
}{%
    \hfill\Virgo%
    \end{remarkinner}
    \end{mdframed}
}

% Hyperref and cross-referencing (load near the end)
\RequirePackage[colorlinks=true]{hyperref}
\RequirePackage[capitalise, nameinlink]{cleveref}

% cleveref setup for custom theorems
\crefname{definitioninner}{Definition}{Definitions}
\Crefname{definitioninner}{Definition}{Definitions}
\crefname{theoreminner}{Theorem}{Theorems}
\Crefname{theoreminner}{Theorem}{Theorems}
\crefname{corollaryinner}{Corollary}{Corollaries}
\Crefname{corollaryinner}{Corollary}{Corollaries}

% Proof environment customization
\renewcommand\qedsymbol{$\squareneswfill$}
\RequirePackage{etoolbox}
\AtBeginEnvironment{proof}{\setlength{\baselineskip}{17pt}}

% Font setup and other packages
\RequirePackage[default, varnothing]{fontsetup}
\RequirePackage[makeroom]{cancel}
\RequirePackage{subfiles}

\endinput